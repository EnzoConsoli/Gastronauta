<div class="detail-container">

  <div *ngIf="isLoading" class="loading">Carregando detalhes...</div>
  <div *ngIf="error" class="error">{{ error }}</div>

  <div *ngIf="recipe">
    
    <img [src]="fullImageUrl || 'assets/placeholder.png'" 
         alt="Foto de {{ recipe.prato }}" 
         class="recipe-image"
         (error)="onImageError($event)">
    
    <div class="details-section">
      
      <div class="title-row">
        <h1 class="recipe-title">{{ recipe.prato }}</h1>
        <i class="fa-regular fa-heart like-icon"></i> 
      </div>
      
      <section class="rating-section">
        <div class="rating-display">
          <div class="rating-stars">
            <ng-container *ngFor="let i of [].constructor(fullStars)"><i class="fa-solid fa-star"></i></ng-container>
            <i *ngIf="hasHalfStar" class="fa-solid fa-star-half-stroke"></i>
            <ng-container *ngFor="let i of [].constructor(emptyStars)"><i class="fa-regular fa-star empty-star"></i></ng-container>
          </div>
          <div class="rating-info">
            <span class="rating-score">{{ ratingValue | number:'1.1-1' }} / 5</span>
            <div class="rating-count">({{ reviewCount }} avaliações)</div>
          </div>
        </div>
        <button class="btn-avaliar" (click)="ratingModal.show()">
          <i class="fa-regular fa-star"></i> Avalie essa receita
        </button>
      </section>

      <div class="info-row">
        <div class="info-item" *ngIf="recipe.dificuldade"><span class="info-label">Nível</span><span>{{ recipe.dificuldade }}</span></div>
        <div class="info-item" *ngIf="recipe.custo"><span class="info-label">Custo</span><span>{{ recipe.custo }}</span></div>
        <div class="info-item" *ngIf="recipe.tempo_preparo"><span class="info-label">Preparo</span><span>{{ recipe.tempo_preparo }}</span></div>
        <div class="info-item" *ngIf="recipe.rendimento"><span class="info-label">Rende</span><span>{{ recipe.rendimento }}</span></div>
        <div class="info-item" *ngIf="recipe.cozimento"><span class="info-label">Cozimento</span><span>{{ recipe.cozimento }}</span></div>
      </div>

      <div class="author-section">
        <div class="author-avatar"></div> 
        <div class="author-details">
           <div class="author-label">Postado por:</div>
           <div class="author-username">@{{ recipe.nome_usuario }}</div>
        </div>
      </div>

      <div *ngIf="isOwner" class="action-buttons">
        <button class="btn-action" (click)="editarReceita()">Editar Receita</button>
        <button class="btn-action btn-delete" (click)="excluirReceita()">Excluir Receita</button>
      </div>

      <div *ngIf="recipe.descricao">
        <h2 class="section-title">Descrição:</h2>
        <p class="preparation-steps">{{ recipe.descricao }}</p>
      </div>

      <h2 class="section-title">Ingredientes:</h2>
      <ul class="ingredients-list">
        <li *ngFor="let item of recipe.ingredientsList">{{ item }}</li>
      </ul>

      <h2 class="section-title">Modo de preparo:</h2>
      <p class="preparation-steps">{{ recipe.preparacao }}</p>

    </div> 
  </div> 
</div> 

<app-popup #deleteConfirmPopup (confirmAction)="confirmarExclusao()"></app-popup>

<app-rating-modal #ratingModal (onPublish)="publicarAvaliacao($event)"></app-rating-modal>